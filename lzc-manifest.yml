package: cloud.lazycat.app.liu.skipper
version: 0.22.170

name: Skipper
keywords: http,router,proxy,reverse-proxy,kubernetes,ingress,load-balancer

description: |
  Skipper æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ HTTP è·¯ç”±å™¨å’Œåå‘ä»£ç†,ç”± Zalando å¼€å‘å¹¶å¼€æº,ä¸“ä¸ºæœåŠ¡ç»„åˆå’Œé«˜æ€§èƒ½åœºæ™¯è®¾è®¡ã€‚ç”Ÿäº§ç¯å¢ƒæ”¯æŒè¶…è¿‡ 80 ä¸‡æ¡è·¯ç”±,æ¯ç§’ 6 ä¸‡æ¬¡è¯·æ±‚ã€‚

locales:
  zh:
    name: Skipper
    description: |
      Skipper æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ HTTP è·¯ç”±å™¨å’Œåå‘ä»£ç†,ç”± Zalando å¼€å‘å¹¶å¼€æº,ä¸“ä¸ºæœåŠ¡ç»„åˆå’Œé«˜æ€§èƒ½åœºæ™¯è®¾è®¡,åŒ…æ‹¬ Kubernetes Ingress ç­‰ç”¨ä¾‹ã€‚

      **ä¸»è¦ç‰¹æ€§:**
      - ğŸš€ é«˜æ€§èƒ½: ç”Ÿäº§ç¯å¢ƒæ”¯æŒè¶…è¿‡ 80 ä¸‡æ¡è·¯ç”±,æ¯ç§’ 6 ä¸‡æ¬¡è¯·æ±‚
      - ğŸ”§ çµæ´»é…ç½®: ä½¿ç”¨ eskip æ ¼å¼é…ç½®è·¯ç”±,æ”¯æŒä¸°å¯Œçš„è¿‡æ»¤å™¨å’Œè°“è¯
      - ğŸ¯ åŠŸèƒ½ä¸°å¯Œ: æ”¯æŒè·¯å¾„é‡å†™ã€é™æµã€è¯·æ±‚ä¿®æ”¹ã€è´Ÿè½½å‡è¡¡ç­‰
      - ğŸ“Š å¯è§‚æµ‹æ€§: å†…ç½® Prometheus æŒ‡æ ‡æ”¯æŒ,æ–¹ä¾¿ç›‘æ§å’Œåˆ†æ

      **å¿«é€Ÿå¼€å§‹:**
      1. éƒ¨ç½²åè®¿é—®ä½¿ç”¨æ–‡æ¡£: https://skipper.{box-name}.heiyu.space/lzc-skipper-readme/
      2. é…ç½®æ–‡ä»¶ä½ç½®: `/data/appvar/cloud.lazycat.app.liu.skipper/config/routes.eskip`
      3. ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯æœåŠ¡ä½¿å…¶ç”Ÿæ•ˆ

      **é…ç½®ç¤ºä¾‹:**
      ```
      # ç®€å•åå‘ä»£ç†
      google: Path("/google") -> "https://www.google.com";

      # é™æ€å“åº”
      hello: Path("/hello") -> inlineContent("Hello World!") -> <shunt>;

      # è·¯å¾„é‡å†™
      api: Path("/api/*path") -> modPath("^/api", "") -> "https://api.example.com";

      # é™æµä¿æŠ¤
      limited: Path("/limited") -> clientRatelimit(100, "1m") -> "https://backend.com";
      ```

      **ç«¯å£è¯´æ˜:**
      - ä¸»æœåŠ¡ (HTTPS): é€šè¿‡åŸŸåè®¿é—®,å¤„ç†æ‰€æœ‰è·¯ç”±è¯·æ±‚
      - ç®¡ç†ç«¯å£ (9911): é€šè¿‡ `http://åŸŸå:9911` è®¿é—®,æä¾›å¥åº·æ£€æŸ¥ã€è·¯ç”±æŸ¥çœ‹ã€æŒ‡æ ‡ç­‰åŠŸèƒ½

      **å®˜æ–¹æ–‡æ¡£:** https://opensource.zalando.com/skipper/

  en:
    name: Skipper
    description: |
      Skipper is a powerful HTTP router and reverse proxy developed and open-sourced by Zalando, designed for service composition and high-performance scenarios, including use cases like Kubernetes Ingress.

      **Key Features:**
      - ğŸš€ High Performance: Supports over 800,000 routes and 60,000 requests per second in production
      - ğŸ”§ Flexible Configuration: Configure routes using eskip format with rich filters and predicates
      - ğŸ¯ Feature Rich: Supports path rewriting, rate limiting, request modification, load balancing, and more
      - ğŸ“Š Observability: Built-in Prometheus metrics support for easy monitoring and analysis

      **Quick Start:**
      1. Access documentation after deployment: https://skipper.{box-name}.heiyu.space/lzc-skipper-readme/
      2. Configuration file location: `/data/appvar/cloud.lazycat.app.liu.skipper/config/routes.eskip`
      3. Restart service after modifying configuration for changes to take effect

      **Configuration Examples:**
      ```
      # Simple reverse proxy
      google: Path("/google") -> "https://www.google.com";

      # Static response
      hello: Path("/hello") -> inlineContent("Hello World!") -> <shunt>;

      # Path rewriting
      api: Path("/api/*path") -> modPath("^/api", "") -> "https://api.example.com";

      # Rate limiting
      limited: Path("/limited") -> clientRatelimit(100, "1m") -> "https://backend.com";
      ```

      **Port Description:**
      - Main Service (HTTPS): Access via domain, handles all routing requests
      - Admin Port (9911): Access via `http://domain:9911`, provides health checks, route viewing, metrics, etc.

      **Official Documentation:** https://opensource.zalando.com/skipper/

license: https://github.com/zalando/skipper?tab=License-1-ov-file#readme
homepage: https://github.com/zalando/skipper
author: liu

application:
  subdomain: skipper
  background_task: false
  multi_instance: false

  routes:
    - /=http://skipper:9090

  public_path:
    - /                         # æ— éœ€ç™»å½•å³å¯è®¿é—®

  # TCP/UDP æœåŠ¡é…ç½®
  ingress:
    - protocol: tcp                       # åè®®ç±»å‹ (tcp/udp)
      port: 9911                            # ç›®æ ‡ç«¯å£å· (ç•™ç©ºåˆ™ä½¿ç”¨å…¥ç«™ç«¯å£)
      service: skipper                        # æœåŠ¡å®¹å™¨åç§° (ç•™ç©ºåˆ™ä¸º app)
      description: skipper ç®¡ç†æœåŠ¡               # æœåŠ¡æè¿°
      publish_port: "9911"                # å…¥ç«™ç«¯å£å· (æ”¯æŒ "1000-50000" èŒƒå›´)
      send_port_info: false               # å‘é€ uint16 ç«¯å£ä¿¡æ¯ (little endian)
      yes_i_want_80_443: false            # å…è®¸ 80/443 æµé‡ (ç»•è¿‡ç³»ç»Ÿé‰´æƒ,æ…ç”¨!)


  # é«˜çº§ç‰ˆ HTTP è·¯ç”±è§„åˆ™ (ä¸ routes å…±å­˜, v1.3.8+ æ”¯æŒåŸºäºåŸŸåè½¬å‘)
  upstreams:
    - location: /lzc-skipper-readme
      backend: file:///lzcapp/pkg/content/ # é™æ€æ–‡ä»¶æœåŠ¡

  depends_on:
    - skipper

services:
  skipper:
    # lzc-cli appstore copy-image ghcr.io/zalando/skipper:v0.22.170
    image: registry.lazycat.cloud/liu/zalando/skipper:db2db1e930e99b53
    environment:
      - SKIPPER_CMD_EXTRA=-insecure
    setup_script: |
      #!/bin/sh
      skipper \
      -routes-file=/etc/skipper/routes.eskip \
      -address=:9090 \
      -support-listener=:9911 \
      ${SKIPPER_CMD_EXTRA}
    binds:
      - /lzcapp/var/config:/etc/skipper

    health_check:
      test:
        - CMD-SHELL
        - 'wget --quiet --tries=1 --spider http://localhost:9090/health'
    depends_on:
      - init-config

  init-config:
    # lzc-cli appstore copy-image alpine:latest
    image: registry.lazycat.cloud/liu/library/alpine:fa375aa75442b364
    setup_script: |
      CONFIG_DIR="/config"
      DEFAULT_DIR="/lzcapp/pkg/content/config"
      if [ ! -f /config/routes.eskip ]; then
        echo "No existing Master config found, copying default config."
        mkdir -p /config
        cp -f "${DEFAULT_DIR}/routes.eskip" "${CONFIG_DIR}/routes.eskip"
      else
        echo "Existing config found, skipping copy."
        cat /config/routes.eskip
      fi

      # Create a marker file to indicate initialization is complete
      touch /tmp/init-complete

      sleep infinity
    binds:
      - /lzcapp/var/config:/config
    health_check:
      test:
        - CMD
        - test
        - -f
        - /tmp/init-complete
